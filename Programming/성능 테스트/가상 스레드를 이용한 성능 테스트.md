Java 21+ 가상 스레드를 이용한 성능 테스트 

JDK 24 Release 이후 플랫폼 스레드 vs 가상 스레드의 성능 테스트를 위해서 오랜만에 스프링 부트에서 간단하게 API를 구현하여 테스트를 해봤습니다.

실제 성능 테스트는 코드 기반으로 작성하였고, gatling이라는 gradle 플러그인을 사용하여 task로 실행하였습니다.

스프링 부트 3.2 이후부터는 application.yml 파일에서 spring.threads.virtual.enabled 설정을 지원하고 있어서 플랫폼 스레드와 가상 스레드로 스위칭 변경이 용이해서 좋았습니다.

아래와 같은 테스트 시나리오를 코드기반으로 작성하였습니다.

```kotlin
package simulations  
  
import io.gatling.javaapi.core.CoreDsl.exec  
import io.gatling.javaapi.core.CoreDsl.rampUsers  
import io.gatling.javaapi.core.CoreDsl.scenario  
import io.gatling.javaapi.core.Simulation  
import io.gatling.javaapi.http.HttpDsl.http  
import io.gatling.javaapi.http.HttpDsl.status  
import java.time.Duration  
  
class AsyncVsVirtualSimulation : Simulation() {  
  
    private val httpProtocol = http.baseUrl("http://localhost:8080")  
        .acceptHeader("application/json")  
  
    // virtual-thread 컨트롤러 시나리오  
    private val virtualScenario = scenario("Virtual Thread Controller")  
        .during(Duration.ofMinutes(2)).on (  
            exec(http("GET /vthread")  
                .get("/vthread")  
                .check(status().`is`(200))  
            )  
        )  
  
    init {  
        setUp(  
            virtualScenario.injectOpen(  
                rampUsers(500).during(Duration.ofSeconds(30))  
            )  
        ).protocols(httpProtocol)  
            .maxDuration(Duration.ofMinutes(3))  
    }  
}
```


